import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { TopBar } from "elements/panels/top_bar.slint";
import { Palette } from "elements/palette.slint";
import { StatsPanel } from "elements/panels/stats.slint";
import { Line } from "elements/drawing.slint";
import { SavesProficiencies } from "elements/panels/saves_profs.slint";
import { SlintCharacter } from "logic.slint";
import { EditMode } from "elements/globals.slint";
import { AcHpMoneyPanel } from "elements/panels/ac_hp_money.slint";

import "fonts/typey.otf";
import { FeaturesAndTraits } from "elements/panels/features_traits.slint";
import { SpellList } from "elements/panels/spelllist.slint";

export component AppWindow inherits Window {
    width: 1920px;
    height: 1000px;
    in-out property <SlintCharacter> character;

    default-font-family: "Typey McTypeface";

    // callbacks
    callback add-money(string, string);
    callback subtract-money(string, string);

    callback take-damage(string);
    callback heal(string);
    callback add-temp-hp(string);
    callback subtract-temp-hp(string);

    callback use-hit-dice();

    callback add-death-save-success();
    callback add-death-save-failure();
    callback reset-death-saves();

    // (from, to, amount-as-string)
    callback convert-money(string, string, string);

    callback use-spell-slot(string);
    callback add-spell-slot(string);

    background: Palette.background_color;
    TopBar {in-character: character;}
    HorizontalLayout {
        x: 0;
        y: 100px;
        alignment: start;

        StatsPanel {in-character: character;}

        Line {
            from: {x: 0, y: 0};
            to: {x: 0, y: 100.0};
            stroke: Palette.text_color;
        }

        SavesProficiencies {in-character: character;}
        
        Line {
            from: {x: 0, y: 0};
            to: {x: 0, y: 100.0};
            stroke: Palette.text_color;
        }

        AcHpMoneyPanel {
            in-character: character;
            add-money(string, int) => {
                add-money(string, int);
            }
            subtract-money(string, int) => {
                subtract-money(string, int);
            }
            take-damage(string) => {
                take-damage(string);
            }
            heal(string) => {
                heal(string);
            }
            add-temp-hp(string) => {
                add-temp-hp(string);
            }
            subtract-temp-hp(string) => {
                subtract-temp-hp(string);
            }
            use-hit-dice => {
                use-hit-dice();
            }
            add-failure => {
                add-death-save-failure();
            }
            add-success => {
                add-death-save-success();
            }
            reset-death-saves => {
                reset-death-saves();
            }
            convert-money(from, to, amount) => {
                convert-money(from, to, amount);
            }
        }

        Line {
            from: {x: 0, y: 0};
            to: {x: 0, y: 100.0};
            stroke: Palette.text_color;
        }

        FeaturesAndTraits {
            in-character: character;
        }

        Line {
            from: {x: 0, y: 0};
            to: {x: 0, y: 100.0};
            stroke: Palette.text_color;
        }

        SpellList {
            in-character: character;
            widget-width: 750px;
            use-spell-slot(string) => {
                use-spell-slot(string);
            }
            add-spell-slot(string) => {
                add-spell-slot(string);
            }
        }

        Line {
            from: {x: 0, y: 0};
            to: {x: 0, y: 100.0};
            stroke: Palette.text_color;
        }
    }
}
